<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Using the Platform MBean Server and Platform MXBeans</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Monitoring and Management Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Monitoring and Management Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-se-monitoring-and-management-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-21T10:39:15-07:00">
      
      <meta name="dcterms.dateCopyrighted" content="2006, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95200-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="using-jconsole.html" title="Previous" type="text/html">
      <link rel="next" href="java-discovery-protocol.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.title" content="Java SE Monitoring and Management Guide">
    <meta name="dcterms.isVersionOf" content="MANAGEMENT">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="using-jconsole.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="java-discovery-protocol.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Monitoring and Management Guide</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Using the Platform MBean Server and Platform MXBeans</li>
            </ol>
            <a id="GUID-6239456C-FD46-46EA-96EF-DC02800D58EC" name="GUID-6239456C-FD46-46EA-96EF-DC02800D58EC"></a>
            
            <h2 id="JSMGM-GUID-6239456C-FD46-46EA-96EF-DC02800D58EC" class="sect2"><span class="enumeration_chapter">4 </span>Using the Platform MBean Server and Platform MXBeans
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This topic introduces the MBean server and the MXBeans that are provided as part of the Java Platform, Standard Edition (Java SE), which can be used for monitoring and management purposes. Java Management Extensions (JMX) technology MBeans and MBean servers were introduced briefly in <a href="overview-java-se-monitoring-and-management.html#GUID-EA3CFF69-F0D3-47AB-9AED-EF1CBF7F2B24" title="The Java Virtual Machine (Java VM) is instrumented for monitoring and management, enabling built-in (or ready-to-use) management capabilities that can be accessed both remotely and locally."> Overview of Java SE Monitoring and Management</a>. See <a href="https://www.oracle.com/pls/topic/lookup?ctx=en/java/javase/11/management&amp;id=JSJMX-GUID-72DCB4C1-93F8-4F37-B46E-2C708139C8A5" target="_blank">Introduction to JMX Technology</a> in <span><cite>Java Platform, Standard Edition Java Management Extensions Guide</cite></span>.
               </p>
            </div>
            <div class="sect2"><a id="GUID-656AF20D-E386-4F75-9079-9B26F9EDCD68" name="GUID-656AF20D-E386-4F75-9079-9B26F9EDCD68"></a><h3 id="JSMGM-GUID-656AF20D-E386-4F75-9079-9B26F9EDCD68" class="sect3">Using the Platform MBean Server</h3>
               <div>
                  <p>An MBean server is a repository of MBeans that provides management applications access to MBeans. Applications do not access MBeans directly, but instead access them through the MBean server using their unique <code class="codeph">ObjectName</code> class. An MBean server implements the interface <code class="codeph">javax.management.MBeanServer</code>.&nbsp;
                  </p>
                  <p>The <span class="variable" translate="no">platform MBean server</span> was introduced in Java SE  5.0, and is an MBean server that is built into the Java Virtual Machine (Java VM). The platform MBean server can be shared by all managed components that are running in the Java VM. You access the platform MBean server using the <code class="codeph">java.lang.management.ManagementFactory</code> method <code class="codeph">getPlatformMBeanServer</code>. Of course, you can also create your own MBean server using the <code class="codeph">javax.management.MBeanServerFactory</code> class. However, there is generally no need for more than one MBean server, so using the platform MBean server is recommended.
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-64A12637-275D-42C7-AB31-2170F424DA2E" name="GUID-64A12637-275D-42C7-AB31-2170F424DA2E"></a><h3 id="JSMGM-GUID-64A12637-275D-42C7-AB31-2170F424DA2E" class="sect3">Accessing Platform MXBeans</h3>
               <div>
                  <p>A <span class="variable" translate="no">platform MXBean</span> is an MBean for monitoring and managing the Java VM. Each MXBean encapsulates a part of the VM functionality. A full list of the MXBeans that are provided with the platform is provided in <a href="overview-java-se-monitoring-and-management.html#GUID-762C5224-0541-4A1B-A314-F3D55311C124__PLATFORMMXBEANS-4D30B595" title="Platform MXBeans">Table 1-1</a>.
                  </p>
                  <p>A management application can access platform MXBeans in three different ways:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Direct access from the <code class="codeph">ManagementFactory</code> class
                        </p>
                     </li>
                     <li>
                        <p>Direct access from an MXBean proxy</p>
                     </li>
                     <li>
                        <p>Indirect access from the <code class="codeph">MBeanServerConnection</code> class
                        </p>
                     </li>
                  </ul>
               </div>
               <div class="sect3"><a id="GUID-96CEF00E-83E8-4505-B6E1-6E89213FB0CA" name="GUID-96CEF00E-83E8-4505-B6E1-6E89213FB0CA"></a><h4 id="JSMGM-GUID-96CEF00E-83E8-4505-B6E1-6E89213FB0CA" class="sect4">Accessing Platform MXBeans Using the ManagementFactory Class</h4>
                  <div>
                     <p>An application can make direct calls to the methods of a platform MXBean that is running in the same Java VM as itself. To make direct calls, you can use the static methods of the <code class="codeph">ManagementFactory</code> class. The <code class="codeph">ManagementFactory</code> class has <code class="codeph">accessor</code> methods for each of the different platform MXBeans, such as, <code class="codeph">getClassLoadingMXBean()</code>, <code class="codeph">getGarbageCollectorMXBeans()</code>, <code class="codeph">getRuntimeMXBean()</code>, and so on. In case there are more than one platform MXBean, the method returns a list of the platform MXBeans found.
                     </p>
                     <p>For example, <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-96CEF00E-83E8-4505-B6E1-6E89213FB0CA__EXAMPLE4-1ACCESSINGAPLATFORMMXBEANU-8F3B94EC">Example&nbsp;4-1</a> uses the static method of <code class="codeph">ManagementFactory</code> to get the platform MXBean <code class="codeph">RuntimeMXBean</code>, and then gets the vendor name from the platform MXBean.
                     </p>
                     <p id="GUID-96CEF00E-83E8-4505-B6E1-6E89213FB0CA__EXAMPLE4-1ACCESSINGAPLATFORMMXBEANU-8F3B94EC">Example&nbsp;4-1 Accessing a Platform MXBean Using ManagementFactory Class</p><pre class="pre codeblock"><code>RuntimeMXBean mxbean = ManagementFactory.getRuntimeMXBean();
String vendor = mxbean.getVmVendor(); 
</code></pre></div>
               </div>
               <div class="sect3"><a id="GUID-4C287D90-7F37-41FC-9B73-D93B0C814A57" name="GUID-4C287D90-7F37-41FC-9B73-D93B0C814A57"></a><h4 id="JSMGM-GUID-4C287D90-7F37-41FC-9B73-D93B0C814A57" class="sect4">Accessing Platform MXBeans Using an MXBean Proxy</h4>
                  <div>
                     <p>An application can also call platform MXBean methods using an MXBean proxy. To do so, you must construct an MXBean proxy instance that forwards the method calls to a given MBean server by calling the static method <code class="codeph">ManagementFactory.newPlatformMXBeanProxy()</code>. An application typically constructs a proxy to obtain remote access to a platform MXBean of another Java VM.
                     </p>
                     <p>For example, <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-4C287D90-7F37-41FC-9B73-D93B0C814A57__EXAMPLE4-2ACCESSINGAPLATFORMMXBEANV-8F3C48A5">Example&nbsp;4-2</a> performs exactly the same operation as <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-96CEF00E-83E8-4505-B6E1-6E89213FB0CA__EXAMPLE4-1ACCESSINGAPLATFORMMXBEANU-8F3B94EC">Example&nbsp;4-1</a>, but this time it uses an MXBean proxy.
                     </p>
                     <p id="GUID-4C287D90-7F37-41FC-9B73-D93B0C814A57__EXAMPLE4-2ACCESSINGAPLATFORMMXBEANV-8F3C48A5">Example&nbsp;4-2 Accessing a Platform MXBean Using an MXBean Proxy </p><pre class="pre codeblock"><code>MBeanServerConnection mbs;
...
// Get a MBean proxy for RuntimeMXBean interface
RuntimeMXBean proxy =
    ManagementFactory.newPlatformMXBeanProxy(mbs,ManagementFactory.RUNTIME_MXBEAN_NAME,RuntimeMXBean.class);
// Get standard attribute "VmVendor"
String vendor = proxy.getVmVendor();
</code></pre></div>
               </div>
               <div class="sect3"><a id="GUID-7D0C32D9-7317-42B5-8F39-301A977A3ED5" name="GUID-7D0C32D9-7317-42B5-8F39-301A977A3ED5"></a><h4 id="JSMGM-GUID-7D0C32D9-7317-42B5-8F39-301A977A3ED5" class="sect4">Accessing Platform MXBeans Using the MBeanServerConnection Class</h4>
                  <div>
                     <p>An application can indirectly call platform MXBean methods through an <code class="codeph">MBeanServerConnection</code> interface that connects to the platform MBean server of another running Java VM. You use the <code class="codeph">MBeanServerConnection</code> class <code class="codeph">getAttribute()</code> method to get an attribute of a platform MXBean by providing the MBean's <code class="codeph">ObjectName</code> and the attribute name as parameters.
                     </p>
                     <p>For example, <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-7D0C32D9-7317-42B5-8F39-301A977A3ED5__EXAMPLE4-3ACCESSINGAPLATFORMMXBEANU-8F3CBD97">Example&nbsp;4-3</a> performs the same job as <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-96CEF00E-83E8-4505-B6E1-6E89213FB0CA__EXAMPLE4-1ACCESSINGAPLATFORMMXBEANU-8F3B94EC">Example&nbsp;4-1</a> and <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-4C287D90-7F37-41FC-9B73-D93B0C814A57__EXAMPLE4-2ACCESSINGAPLATFORMMXBEANV-8F3C48A5">Example&nbsp;4-2</a>, but it uses an indirect call through <code class="codeph">MBeanServerConnection</code>.
                     </p>
                     <p id="GUID-7D0C32D9-7317-42B5-8F39-301A977A3ED5__EXAMPLE4-3ACCESSINGAPLATFORMMXBEANU-8F3CBD97">Example&nbsp;4-3 Accessing a Platform MXBean Using the MBeanServerConnection Class</p><pre class="pre codeblock"><code>MBeanServerConnection mbs;
...
try {
  ObjectName oname = new ObjectName(ManagementFactory.RUNTIME_MXBEAN_NAME);
  // Get standard attribute "VmVendor"
  String vendor = (String) mbs.getAttribute(oname, "VmVendor");
} catch (....) {
  // Catch the exceptions thrown by ObjectName constructor
  // and MBeanServer.getAttribute method
  ...
}
</code></pre></div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-89C9B849-87E0-499E-A3EF-DD772C21C978" name="GUID-89C9B849-87E0-499E-A3EF-DD772C21C978"></a><h3 id="JSMGM-GUID-89C9B849-87E0-499E-A3EF-DD772C21C978" class="sect3">Using Oracle JDK's Platform Extension</h3>
               <div>
                  <p>Java VMs can extend the management interface by defining interfaces for platform-specific measurements and management operations. The static factory methods in the <code class="codeph">ManagementFactory</code> class will return the MBeans with the platform extension.
                  </p>
                  <p>The <code class="codeph">com.sun.management</code> package contains Oracle JDK's platform extensions. The following sections provide examples of how to access a platform-specific attribute from Oracle JDK's implementation of the <code class="codeph">OperatingSystemMXBean</code> interface.
                  </p>
               </div>
               <div class="sect3"><a id="GUID-DB0DFAD1-8BB2-4A9C-B3D4-3868856C4D76" name="GUID-DB0DFAD1-8BB2-4A9C-B3D4-3868856C4D76"></a><h4 id="JSMGM-GUID-DB0DFAD1-8BB2-4A9C-B3D4-3868856C4D76" class="sect4">Accessing MXBean Attributes Directly</h4>
                  <div>
                     <p><a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-DB0DFAD1-8BB2-4A9C-B3D4-3868856C4D76__EXAMPLE4-4ACCESSINGANMXBEANATTRIBUT-8F3D42EF">Example&nbsp;4-4</a> illustrates direct access to one of Oracle JDK's MXBean interfaces.
                     </p>
                     <p id="GUID-DB0DFAD1-8BB2-4A9C-B3D4-3868856C4D76__EXAMPLE4-4ACCESSINGANMXBEANATTRIBUT-8F3D42EF">Example&nbsp;4-4 Accessing an MXBean Attribute Directly </p><pre class="pre codeblock"><code>com.sun.management.OperatingSystemMXBean mxbean =
  (com.sun.management.OperatingSystemMXBean) ManagementFactory.getOperatingSystemMXBean();

// Get the number of processors
int numProcessors = mxbean.getAvailableProcessors();

// Get the Oracle JDK-specific attribute Process CPU time
long cpuTime = mxbean.getProcessCpuTime();
</code></pre></div>
               </div>
               <div class="sect3"><a id="GUID-F4A461C6-9BDD-4601-B247-8706DB2BF3DE" name="GUID-F4A461C6-9BDD-4601-B247-8706DB2BF3DE"></a><h4 id="JSMGM-GUID-F4A461C6-9BDD-4601-B247-8706DB2BF3DE" class="sect4">Accessing MXBean Attributes Using MBeanServerConnection</h4>
                  <div>
                     <p><a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-F4A461C6-9BDD-4601-B247-8706DB2BF3DE__EXAMPLE4-5ACCESSINGANMXBEANATTRIBUT-8F3D7096">Example&nbsp;4-5</a> illustrates access to one of Oracle JDK's MXBean interfaces using the <code class="codeph">MBeanServerConnection</code> class.
                     </p>
                     <p id="GUID-F4A461C6-9BDD-4601-B247-8706DB2BF3DE__EXAMPLE4-5ACCESSINGANMXBEANATTRIBUT-8F3D7096">Example&nbsp;4-5 Accessing an MXBean Attribute Using MBeanServerConnection</p><pre class="pre codeblock"><code>MBeanServerConnection mbs;

// Connect to a running Java VM (or itself) and get MBeanServerConnection
// that has the MXBeans registered in it
...

try {
    // Assuming the OperatingSystem MXBean has been registered in mbs
    ObjectName oname = new ObjectName(ManagementFactory.OPERATING_SYSTEM_MXBEAN_NAME);

    // Get standard attribute "Name"
    String vendor = (String) mbs.getAttribute(oname, "Name");

    // Check if this MXBean contains Oracle JDK's extension
    if (mbs.isInstanceOf(oname, "com.sun.management.OperatingSystemMXBean")) {
        // Get platform-specific attribute "ProcessCpuTime"
        long cpuTime = (Long) mbs.getAttribute(oname, "ProcessCpuTime");
    }
} catch (....) {
    // Catch the exceptions thrown by ObjectName constructor
    // and MBeanServer methods
    ...
}
</code></pre></div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-E954720D-0C11-491C-8784-4364738DDEE3" name="GUID-E954720D-0C11-491C-8784-4364738DDEE3"></a><h3 id="JSMGM-GUID-E954720D-0C11-491C-8784-4364738DDEE3" class="sect3">Monitoring Thread Contention and CPU Time</h3>
               <div>
                  <p>The <code class="codeph">ThreadMXBean</code> platform MXBean provides support for monitoring thread contention and thread central processing unit (CPU) time.
                  </p>
                  <p>The Oracle JDK's HotSpot VM supports thread contention monitoring. You use the <code class="codeph">ThreadMXBean.isThreadContentionMonitoringSupported()</code> method to determine if a Java VM supports thread contention monitoring. Thread contention monitoring is disabled by default. Use the <code class="codeph">setThreadContentionMonitoringEnabled()</code> method to enable it.
                  </p>
                  <p>The Oracle JDK's HotSpot VM supports the measurement of thread CPU time on most platforms. The CPU time provided by this interface has nanosecond precision but not necessarily nanosecond accuracy.</p>
                  <p>You use the <code class="codeph">isThreadCpuTimeSupported()</code> method to determine if a Java VM supports the measurement of the CPU time for any thread. You use <code class="codeph">isCurrentThreadCpuTimeSupported()</code> to determine if a Java VM supports the measurement of the CPU time for the current thread. A Java VM that supports CPU time measurement for any thread will also support that for the current thread.
                  </p>
                  <p>A Java VM can disable thread CPU time measurement. You use the <code class="codeph">isThreadCpuTimeEnabled()</code> method to determine if thread CPU time measurement is enabled. You use the <code class="codeph">setThreadCpuTimeEnabled()</code> method to enable or disable the measurement of thread CPU time.
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-470524BF-8291-485F-95BD-C4185A0A4D2D" name="GUID-470524BF-8291-485F-95BD-C4185A0A4D2D"></a><h3 id="JSMGM-GUID-470524BF-8291-485F-95BD-C4185A0A4D2D" class="sect3">Managing the Operating System</h3>
               <div>
                  <p>The <code class="codeph">OperatingSystem</code> platform MXBean allows you to access certain operating system resource information, such as the following:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Process CPU time</p>
                     </li>
                     <li>
                        <p>Amount of total and free physical memory</p>
                     </li>
                     <li>
                        <p>Amount of committed virtual memory (that is, the amount of virtual memory guaranteed to be available to the running process)</p>
                     </li>
                     <li>
                        <p>Amount of total and free swap space</p>
                     </li>
                     <li>
                        <p>Number of open file descriptors (only for Solaris, Linux, or macOS platforms).</p>
                     </li>
                  </ul>
                  <p>When the Operating System MXBean in the MBeans tab is selected in JConsole, you see all the attributes and operations including the platform extension. You can monitor the changes of a numerical attribute over time by double-clicking the value field of the attribute.</p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-E7CCD12F-00C4-4547-B3F4-E9D969768C9E" name="GUID-E7CCD12F-00C4-4547-B3F4-E9D969768C9E"></a><h3 id="JSMGM-GUID-E7CCD12F-00C4-4547-B3F4-E9D969768C9E" class="sect3">Logging Management</h3>
               <div>
                  <p>The Java SE platform provides a special MXBean for logging purposes, the <code class="codeph">LoggingMXBean</code> interface.
                  </p>
                  <p>The <code class="codeph">LoggingMXBean</code> interface enables you to perform the following tasks:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Get the name of the log level associated with the specified logger</p>
                     </li>
                     <li>
                        <p>Get the list of currently registered loggers</p>
                     </li>
                     <li>
                        <p>Get the name of the parent for the specified logger</p>
                     </li>
                     <li>
                        <p>Set the specified logger to the specified new level</p>
                     </li>
                  </ul>
                  <p>The unique <code class="codeph">ObjectName</code> of the <code class="codeph">LoggingMXBean</code> is <code class="codeph">java.util.logging:type=Logging</code>. This object name is stored in the <code class="codeph">LogManager.LOGGING_MXBEAN_NAME</code> field.
                  </p>
                  <p>There is a single global instance of the <code class="codeph">LoggingMXBean</code> interface, which you can get by calling <code class="codeph">LogManager.getLoggingMXBean()</code>.
                  </p>
                  <p>The <code class="codeph">LoggingMXBean</code> interface defines a <code class="codeph">LoggerNames</code> attribute describing the list of logger names. To find the list of loggers in your application, you can select the <code class="codeph">Logging MXBean</code> interface under the <code class="codeph">java.util.logging</code> domain in the MBeans tab, and double-click the value field of the <code class="codeph">LoggerNames</code> attribute. 
                  </p>
                  <p>The <code class="codeph">Logging MXBean</code> interface also supports two operations:
                  </p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p><code class="codeph">getLoggerLevel</code>: Returns the log level of a given logger
                        </p>
                     </li>
                     <li>
                        <p><code class="codeph">setLoggerLevel</code>: Sets the log level of a given logger to a new level
                        </p>
                     </li>
                  </ul>
                  <p>These operations take a logger name as the first parameter. To change the level of a logger, enter the logger name in the first parameter and the name of the level that it should be set to in the second parameter of the <code class="codeph">setLoggerLevel</code> operation.
                  </p>
               </div>
            </div>
            <div class="sect2"><a id="GUID-76F64803-CD1A-45E2-9C74-3A5E7792EC1A" name="GUID-76F64803-CD1A-45E2-9C74-3A5E7792EC1A"></a><h3 id="JSMGM-GUID-76F64803-CD1A-45E2-9C74-3A5E7792EC1A" class="sect3">Detecting Low Memory</h3>
               <div>
                  <p>Memory use is an important attribute of the memory system. It can be indicative of the following problems:</p>
                  <ul style="list-style-type: disc;">
                     <li>
                        <p>Excessive memory consumption by an application</p>
                     </li>
                     <li>
                        <p>An excessive workload imposed on the automatic memory management system</p>
                     </li>
                     <li>
                        <p>Potential memory leakages</p>
                     </li>
                  </ul>
                  <p>There are two kinds of memory thresholds that you can use to detect low memory conditions: a <span class="variable" translate="no">usage threshold</span> and a <span class="variable" translate="no">collection usage threshold</span>. You can detect low memory conditions using either of these thresholds with <span class="variable" translate="no">polling</span> or <span class="variable" translate="no">threshold notification</span>.
                  </p>
               </div>
               <div class="sect3"><a id="GUID-0D16BF63-86E4-434B-B2A5-BFB0A3AA712D" name="GUID-0D16BF63-86E4-434B-B2A5-BFB0A3AA712D"></a><h4 id="JSMGM-GUID-0D16BF63-86E4-434B-B2A5-BFB0A3AA712D" class="sect4">Memory Thresholds</h4>
                  <div>
                     <p>A memory pool can have two kinds of memory thresholds: a usage
threshold and a collection usage threshold. Either one of these
thresholds may not be supported by a particular memory pool. The
values for the usage threshold and collection usage threshold can
both be set using the MBeans tab in JConsole.</p>
                  </div>
                  <div class="sect4"><a id="GUID-706EADC3-3447-49E2-9490-9DF95AE1CC78" name="GUID-706EADC3-3447-49E2-9490-9DF95AE1CC78"></a><h5 id="JSMGM-GUID-706EADC3-3447-49E2-9490-9DF95AE1CC78" class="sect5">Usage Threshold</h5>
                     <div>
                        <p>The usage threshold is a manageable attribute of some memory pools. It enables you to monitor memory use with a low overhead. Setting the threshold to a positive value enables a memory pool to perform usage threshold checking. Setting the usage threshold to zero disables usage threshold checking. The default value is supplied by the Java VM.</p>
                        <p>A Java VM performs usage threshold checking on a memory pool at the most appropriate time, typically during garbage collection. Each memory pool increments a usage threshold count whenever the usage crosses the threshold.</p>
                        <p>You use the <code class="codeph">isUsageThresholdSupported()</code> method to determine whether a memory pool supports a usage threshold, because a usage threshold is not appropriate for some memory pools. For example, in a generational garbage collector (such as the one in the HotSpot VM; see <a href="using-jconsole.html#GUID-A81AE10A-0693-462A-B129-5E292F46523E">Garbage Collection</a>), most of the objects are allocated in the young generation, from the Eden memory pool. The Eden pool is designed to be filled up. Garbage collecting the Eden memory pool will free most of its memory space because it is expected to contain mostly short-lived objects that are unreachable at garbage collection time. So, it is not appropriate for the Eden memory pool to support a usage threshold.
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-2D3404CA-3458-4222-BE03-F8380909E994" name="GUID-2D3404CA-3458-4222-BE03-F8380909E994"></a><h5 id="JSMGM-GUID-2D3404CA-3458-4222-BE03-F8380909E994" class="sect5">Collection Usage Threshold</h5>
                     <div>
                        <p>The collection usage threshold is a manageable attribute of some garbage-collected memory pools. After a Java VM has performed garbage collection on a memory pool, some memory in the pool will still be in use. The collection usage threshold allows you to set a value for this memory. You use the <code class="codeph">isCollectionUsageThresholdSupported()</code> method of the <code class="codeph">MemoryPoolMXBean</code> interface to determine if the pool supports a collection usage threshold.
                        </p>
                        <p>A Java VM may check the collection usage threshold on a memory pool when it performs garbage collection. Set the collection usage threshold to a positive value to enable checking. Set the collection usage threshold to zero (the default) to disable checking.</p>
                        <p>The usage threshold and collection usage threshold can be set in the MBeans tab of JConsole.</p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-86E4727D-E8AD-4F8E-87BE-49FBAB419684" name="GUID-86E4727D-E8AD-4F8E-87BE-49FBAB419684"></a><h5 id="JSMGM-GUID-86E4727D-E8AD-4F8E-87BE-49FBAB419684" class="sect5">Memory MXBean</h5>
                     <div>
                        <p>The various memory thresholds can be managed using the platform <code class="codeph">MemoryMXBean</code>. The <code class="codeph">MemoryMXBean</code> defines the following four attributes:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">HeapMemoryUsage</code>: A read-only attribute describing the current heap memory usage.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">NonHeapMemoryUsage</code>: A read-only attribute describing nonheap memory usage.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">ObjectPendingFinalizationCount</code>: A read-only attribute describing the number of objects pending for finalization.
                              </p>
                           </li>
                           <li>
                              <p><code class="codeph">Verbose</code>: A Boolean attribute describing the Garbage Collection (GC) verbose tracing setting. This can be set dynamically. The GC verbose traces will be displayed at the location specified when you start the Java VM. The default location for GC verbose output of the Hotspot VM is <code class="codeph">stdout</code>.
                              </p>
                           </li>
                        </ul>
                        <p>The Memory MXBean supports one operation, <code class="codeph">gc</code>, for explicit garbage collection requests.
                        </p>
                        <p>Details of the Memory MXBean interface are defined in the <code class="codeph">java.lang.management.MemoryMXBean</code> specification.
                        </p>
                     </div>
                  </div>
                  <div class="sect4"><a id="GUID-83A05689-B759-4CF2-BB82-7B82D8DA9F25" name="GUID-83A05689-B759-4CF2-BB82-7B82D8DA9F25"></a><h5 id="JSMGM-GUID-83A05689-B759-4CF2-BB82-7B82D8DA9F25" class="sect5">Memory Pool MXBean</h5>
                     <div>
                        <p>The <code class="codeph">MemoryPoolMXBean</code> platform MXBean defines a set of
operations to manage memory thresholds.
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>
                              <p><code class="codeph">getUsageThreshold()</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">setUsageThreshold(long threshold)</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">isUsageThresholdExceeded()</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">isUsageThresholdSupported()</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">getCollectionUsageThreshold()</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">setCollectionUsageThreshold(long threshold)</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">isCollectionUsageThresholdSupported()</code></p>
                           </li>
                           <li>
                              <p><code class="codeph">isCollectionUsageThresholdExceeded()</code></p>
                           </li>
                        </ul>
                        <p>Each memory pool may have two kinds of memory thresholds for low
memory detection support: a usage threshold and a collection usage
threshold. Either one of these thresholds might not be supported by
a particular memory pool. For more information, see the API
reference documentation for the <code class="codeph">MemoryPoolMXBean</code>
class.
                        </p>
                     </div>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1" name="GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1"></a><h4 id="JSMGM-GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1" class="sect4">Polling</h4>
                  <div>
                     <p>An application can continuously monitor its memory usage by calling either the <code class="codeph">getUsage()</code> method for all memory pools or the <code class="codeph">isUsageThresholdExceeded()</code> method for memory pools that support a usage threshold.
                     </p>
                     <p><a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1__EXAMPLE4-6USINGPOLLING-8F3EC957">Example&nbsp;4-6</a> has a thread dedicated to task distribution and processing. At every interval, it determines whether it should receive and process new tasks based on its memory usage. If the memory usage exceeds its usage threshold, then it redistributes outstanding tasks to other VMs and stops receiving new tasks until the memory usage returns below the threshold.
                     </p>
                     <p id="GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1__EXAMPLE4-6USINGPOLLING-8F3EC957">Example&nbsp;4-6 Using Polling </p><pre class="pre codeblock"><code>pool.setUsageThreshold(myThreshold);
....
boolean lowMemory = false;
while (true) {
  if (pool.isUsageThresholdExceeded()) {
    lowMemory = true;
    redistributeTasks();  // redistribute tasks to other VMs
    stopReceivingTasks();  // stop receiving new tasks
  } else {
    if (lowMemory) { // resume receiving tasks
      lowMemory = false;
      resumeReceivingTasks();
    }
    // processing outstanding task
    ...
  }
  // sleep for sometime
  try {
    Thread.sleep(sometime);
  } catch (InterruptedException e) {
    ...
  }
}      
</code></pre><p><a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1__EXAMPLE4-6USINGPOLLING-8F3EC957">Example&nbsp;4-6</a> does not differentiate the case in which the memory usage has temporarily dropped below the usage threshold from the case in which the memory usage remains above the threshold between two iterations. You can use the usage threshold count returned by the <code class="codeph">getUsageThresholdCount()</code> method to determine if the memory usage has returned below the threshold between two polls.
                     </p>
                     <p>To test the collection usage threshold instead, you use the <code class="codeph">isCollectionUsageThresholdSupported()</code>, <code class="codeph">isCollectionThresholdExceeded()</code> and <code class="codeph">getCollectionUsageThreshold()</code> methods in the same way as shown in the <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1__EXAMPLE4-6USINGPOLLING-8F3EC957">Example&nbsp;4-6</a>.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-E2E075B3-9D4F-4F14-825C-99DA09B27812" name="GUID-E2E075B3-9D4F-4F14-825C-99DA09B27812"></a><h4 id="JSMGM-GUID-E2E075B3-9D4F-4F14-825C-99DA09B27812" class="sect4">Threshold Notifications</h4>
                  <div>
                     <p>When the <code class="codeph">MemoryMXBean</code> interface detects that a memory pool has reached or exceeded its usage threshold, it emits a <span class="variable" translate="no">usage threshold exceeded</span> notification. The <code class="codeph">MemoryMXBean</code> interface will not issue another usage threshold exceeded notification until the usage has fallen below the threshold and then exceeded it again. Similarly, when the memory usage after garbage collection exceeds the collection usage threshold, the <code class="codeph">MemoryMXBean</code> interface emits a collection usage threshold exceeded notification.
                     </p>
                     <p><a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-E2E075B3-9D4F-4F14-825C-99DA09B27812__EXAMPLE4-7USINGTHRESHOLDNOTIFICATIO-8F41249C">Example&nbsp;4-7</a> implements the same logic as <a href="using-platform-mbean-server-and-platform-mxbeans.html#GUID-8B19A349-4075-47F2-BC95-3CC88CA96BB1__EXAMPLE4-6USINGPOLLING-8F3EC957">Example&nbsp;4-6</a>, but uses usage threshold notification to detect low memory conditions. Upon receiving a notification, the listener notifies another thread to perform actions such as redistributing outstanding tasks, refusing to accept new tasks, or allowing new tasks to be accepted again.
                     </p>
                     <p>In general, you should design the <code class="codeph">handleNotification</code> method to do a minimal amount of work, to avoid causing delay in delivering subsequent notifications. You should perform time-consuming actions in a separate thread. As multiple threads can concurrently call the notification listener, the listener should synchronize the tasks that it performs properly.
                     </p>
                     <p id="GUID-E2E075B3-9D4F-4F14-825C-99DA09B27812__EXAMPLE4-7USINGTHRESHOLDNOTIFICATIO-8F41249C">Example&nbsp;4-7 Using Threshold Notifications </p><pre class="pre codeblock"><code>class MyListener implements javax.management.NotificationListener {
  public void handleNotification(Notification notification, Object handback)  {
    String notifType = notification.getType();
    if (notifType.equals(MemoryNotificationInfo.MEMORY_THRESHOLD_EXCEEDED)) {
      // potential low memory, redistribute tasks to other VMs &amp; stop receiving new tasks.
      lowMemory = true;
      notifyAnotherThread(lowMemory);
    }
  }
}

// Register MyListener with MemoryMXBean
MemoryMXBean mbean = ManagementFactory.getMemoryMXBean();
NotificationEmitter emitter = (NotificationEmitter) mbean;
MyListener listener = new MyListener();
emitter.addNotificationListener(listener, null, null);
</code></pre><p>Assuming this memory pool supports a usage threshold, you can set the threshold to some value (representing a number of bytes), above which the application will not accept new tasks.</p><pre class="pre codeblock"><code>pool.setUsageThreshold(myThreshold);
</code></pre><p>After this point, usage threshold detection is enabled and <code class="codeph">MyListener</code> class will handle notification.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>
