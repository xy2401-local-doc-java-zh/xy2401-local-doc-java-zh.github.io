<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xml:lang="en-us" lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Security</title>
      <meta property="og:site_name" content="Oracle Help Center">
      <meta property="og:title" content="Java Management Extensions Guide">
      <meta property="og:description" content>
      <link rel="stylesheet" href="/sp_common/book-template/ohc-book-template/css/book.css">
      <link rel="shortcut icon" href="/sp_common/book-template/ohc-common/img/favicon.ico">
      <meta name="application-name" content="Java Management Extensions Guide">
      <meta name="generator" content="DITA Open Toolkit version 1.8.5 (Mode = doc)">
      <meta name="plugin" content="SP_docbuilder HTML plugin release 18.2.2">
      <link rel="alternate" href="java-management-extensions-guide.pdf" title="PDF File" type="application/pdf">
      <meta name="robots" content="all">
      <link rel="schema.dcterms" href="http://purl.org/dc/terms/">
      <meta name="dcterms.created" content="2018-09-20T10:06:58-07:00">
      <meta name="dcterms.title" content="Java Management Extensions Guide">
      <meta name="dcterms.dateCopyrighted" content="1993, 2018">
      <meta name="dcterms.category" content="java">
      <meta name="dcterms.identifier" content="E95075-01">
      
      <meta name="dcterms.product" content="en/java/javase/11">
      <meta name="dcterms.release" content="11">
      <link rel="prev" href="lookup-services.html" title="Previous" type="text/html">
      <link rel="next" href="java-management-extensions-examples.html" title="Next" type="text/html">
      <script>
        document.write('<style type="text/css">');
        document.write('body > .noscript, body > .noscript ~ * { visibility: hidden; }');
        document.write('</style>');
     </script>
      <script data-main="/sp_common/book-template/ohc-book-template/js/book-config" src="/sp_common/book-template/requirejs/require.js"></script>
      <script>
            if (window.require === undefined) {
                document.write('<script data-main="sp_common/book-template/ohc-book-template/js/book-config" src="sp_common/book-template/requirejs/require.js"><\/script>');
                document.write('<link href="sp_common/book-template/ohc-book-template/css/book.css" rel="stylesheet"/>');
            }
        </script>
      <script type="application/json" id="ssot-metadata">{"primary":{"category":{"short_name":"java","element_name":"Java","display_in_url":true},"suite":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product_group":{"short_name":"not-applicable","element_name":"Not Applicable","display_in_url":false},"product":{"short_name":"javase","element_name":"Java SE","display_in_url":true},"release":{"short_name":"11","element_name":"11","display_in_url":true}}}</script>
      
    <meta name="dcterms.isVersionOf" content="JMX">
  <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
   <body>
      <div class="noscript alert alert-danger text-center" role="alert">
         <a href="lookup-services.html" class="pull-left"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>Previous</a>
         <a href="java-management-extensions-examples.html" class="pull-right">Next<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></a>
         <span class="fa fa-exclamation-triangle" aria-hidden="true"></span> JavaScript must be enabled to correctly display this content
        
      </div>
      <article>
         <header>
            <ol class="breadcrumb" vocab="http://schema.org/" typeof="BreadcrumbList">
               <li property="itemListElement" typeof="ListItem"><a href="index.html" property="item" typeof="WebPage"><span property="name">Java Management Extensions Guide</span></a></li>
               <li property="itemListElement" typeof="ListItem"><a href="java-management-extensions-jmx-technology-tutorial.html" property="item" typeof="WebPage"><span property="name">Java Management Extensions (JMX) Technology Tutorial</span></a></li>
               <li class="active" property="itemListElement" typeof="ListItem">Security</li>
            </ol>
            <a id="GUID-2945088A-F715-4BC9-B8AD-6C56BC3BDF55" name="GUID-2945088A-F715-4BC9-B8AD-6C56BC3BDF55"></a>
            
            <h2 id="JSJMX-GUID-2945088A-F715-4BC9-B8AD-6C56BC3BDF55" class="sect2"><span class="enumeration_chapter">13 </span>Security
            </h2>
         </header>
         <div class="ind">
            <div>
               <p>This chapter gives examples of how to set up the JMX technology security features, as described in the following sections:</p>
               <ul style="list-style-type: disc;">
                  <li><a href="security.html#GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D">Simple Security</a> presents examples of connectors that implement straightforward security that is based on password authentication and file access control.
                  </li>
                  <li><a href="security.html#GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D">Subject Delegation</a> presents examples of connectors that use the subject delegation model to perform operations on a given authenticated connection on behalf of several different identities.
                  </li>
                  <li><a href="security.html#GUID-2A161539-E347-4CF1-84B9-482BC0C621C7">Fine-Grained Security</a> presents examples of connectors that implement more sophisticated security mechanisms, in which permission to perform individual operations is controlled.
                  </li>
               </ul>
               <p><span class="bold">Caution:</span></p>
               <ul style="list-style-type: disc;">
                  <li>Applications should prompt the user to enter passwords rather than expecting the user to provide them at the command line.</li>
                  <li>Use secure authentication mechanisms in production systems. In particular, use both SSL client certificates to authenticate the client host, and password authentication for user management. See <span class="italic">Using SSL</span> and <span class="italic">Using LDAP Authentication</span> in the <span><cite>Java Platform, Standard Edition Management Developerâ€™s Guide</cite></span>.
                  </li>
               </ul>
            </div>
            <div class="sect2"><a id="GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D" name="GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D"></a><h3 id="JSJMX-GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D" class="sect3">Simple Security</h3>
               <div>
                  <p>The simplest type of security you can use with the JMX technology is based upon encryption, user name and password authentication, and file access control.</p>
                  <p></p>
                  <div class="section">
                     <p class="subhead2" id="GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D__GUID-D4F192B7-0436-4DEB-B952-29F870C48D77">Analyzing the RMI Connectors with Simple Security Example Classes</p>
                     <ol>
                        <li>
                           <p>Copy the source code from <a href="simple-security-example.html">Simple Security</a> to the following <code class="codeph"><span class="variable" translate="no">work_dir</span>/jmx_examples/Security/simple</code> subdirectories and files:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li><code class="codeph">/server/Server.java</code></li>
                              <li><code class="codeph">/config/access.properties</code></li>
                              <li><code class="codeph">/config/keystore</code></li>
                              <li><code class="codeph">/config/password.properties</code></li>
                              <li><code class="codeph">/config/truststore</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandardMBean.java</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandard.java</code></li>
                              <li><code class="codeph">/client/Client.java</code></li>
                              <li><code class="codeph">/client/ClientListener.java</code></li>
                           </ul>
                        </li>
                        <li>
                           <p>Open the <code class="codeph">*.java</code> and <code class="codeph">*.properties</code> files, in your IDE or text editor. 
                           </p>
                        </li>
                     </ol>
                     <p>The following sections analyze these files and explain how they perform the security operations described above.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84" name="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84"></a><h4 id="JSJMX-GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84" class="sect4">Server.java in the Simple Security Example</h4>
                  <div>
                     <p>The <code class="codeph">Server.java</code> class is shown in CODE&nbsp;EXAMPLE&nbsp;5-1.
                     </p>
                     <div class="section" id="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84__CODEEXAMPLE5-1RMICONNECTOREXAMPLESI-CB039FB8">
                        <p class="subhead3" id="GUID-BB34C33D-4F06-48CF-A239-8489A55CCF84__GUID-01031C54-858B-4F32-8A84-140B3493C9EA">CODE&nbsp;EXAMPLE&nbsp;5-1 RMI Connector Example (Simple Security) Class Server.java </p><pre class="pre codeblock"><code>public class Server { 
 
  public static void main(String[] args) { 
  try { 
       MBeanServer mbs = MBeanServerFactory.createMBeanServer(); 
 
       HashMap env = new HashMap(); 
 
       SslRMIClientSocketFactory csf =  
                  new SslRMIClientSocketFactory(); 
       SslRMIServerSocketFactory ssf =  
                  new SslRMIServerSocketFactory(); 
       env.put(RMIConnectorServer. 
                  RMI_CLIENT_SOCKET_FACTORY_ATTRIBUTE,csf); 
       env.put(RMIConnectorServer. 
                  RMI_SERVER_SOCKET_FACTORY_ATTRIBUTE,ssf); 
 
       env.put("jmx.remote.x.password.file", 
                 "config" + File.separator + "password.properties"); 
       env.put("jmx.remote.x.access.file", 
                 "config" + File.separator + "access.properties"); 
 
       JMXServiceURL url = new JMXServiceURL( 
        "service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
         JMXConnectorServer cs = 
            JMXConnectorServerFactory.newJMXConnectorServer(url,  
                                                            env,  
                                                            mbs); 
       cs.start(); 
     } catch (Exception e) { 
       e.printStackTrace(); 
     } 
  } 
}</code></pre><p>The <code class="codeph">Server</code> class shown in CODE&nbsp;EXAMPLE&nbsp;5-1 creates an MBean server <code class="codeph">mbs</code>, and populates an environment map <code class="codeph">env</code> with a secure RMI client socket factory <code class="codeph">csf</code>, a secure RMI server socket factory <code class="codeph">ssf</code>, and the properties files <code class="codeph">password.properties</code> and <code class="codeph">access.properties</code>.
                        </p>
                        <p>The properties file <code class="codeph">password.properties</code> contains a username and password and is accessed using the JMX Remote API interface <code class="codeph">JMXAuthenticator</code>. Using the property <code class="codeph">jmx.remote.x.</code><code class="codeph">password.file</code> is the same as creating a password-based <code class="codeph">JMXAuthenticator</code> and passing it into the environment map through the <code class="codeph">jmx.remote.authenticator</code> property.
                        </p>
                        <p>The properties file <code class="codeph">access.properties</code> contains a username and a level of access permission that can be either <code class="codeph">readwrite</code> or <code class="codeph">readonly</code>. This represents the level of access this user can have to MBean server operations. This file-based access control is implemented using the JMX technology interface <code class="codeph">MBeanServerForwarder</code>, which wraps the real MBean server inside an access controller MBean server. The access controller MBean server only forwards requests to the real MBean server after performing the appropriate checks.
                        </p>
                        <p><code class="codeph">Server</code> creates a JMX service URL, named <code class="codeph">url</code>, for an RMI connector that will operate over the default JRMP transport, and register an RMI connector stub in an RMI registry on port <code class="codeph">9999</code> of the local host.
                        </p>
                        <p>The MBean server <code class="codeph">mbs</code>, the environment map env and the service URL <code class="codeph">url</code> are all passed to <code class="codeph">JMXConnectorServer</code> to create a new, secure JMX connector server named <code class="codeph">cs</code>.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-6D10FB9B-1F8F-4727-93D4-09E0AE2B8FEB" name="GUID-6D10FB9B-1F8F-4727-93D4-09E0AE2B8FEB"></a><h4 id="JSJMX-GUID-6D10FB9B-1F8F-4727-93D4-09E0AE2B8FEB" class="sect4">SimpleStandardMBean.java in the Simple Security Example</h4>
                  <div>
                     <p>The <code class="codeph">SimpleStandardMBean</code> class defines the same straightforward MBean interface used in <a href="jmx-connectors.html#GUID-4F4C3AAF-B3A5-4165-A30F-963A88DF01CA">SimpleStandardMBean.java in the MBean Example</a>.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F1E9EB84-C874-403A-A88B-A8D4CBBF985F" name="GUID-F1E9EB84-C874-403A-A88B-A8D4CBBF985F"></a><h4 id="JSJMX-GUID-F1E9EB84-C874-403A-A88B-A8D4CBBF985F" class="sect4">SimpleStandard.java in the Simple Security Example</h4>
                  <div>
                     <p>The <code class="codeph">SimpleStandard</code> class defines the same straightforward MBean used in <a href="jmx-connectors.html#GUID-3DF0EA75-3F2E-4218-8A6D-08DC4D3BC4CC">SimpleStandard.java in the MBean Example</a>.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7137FE50-4559-4758-8DE2-69A8F2E473D9" name="GUID-7137FE50-4559-4758-8DE2-69A8F2E473D9"></a><h4 id="JSJMX-GUID-7137FE50-4559-4758-8DE2-69A8F2E473D9" class="sect4">ClientListener.java in the Simple Security Example</h4>
                  <div>
                     <p>The <code class="codeph">ClientListener</code> class defines the same straightforward notification listener used in <a href="jmx-connectors.html#GUID-871B0138-49A6-462D-8CC0-981C595822D0">ClientListener.java in the MBean Example</a>.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E" name="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E"></a><h4 id="JSJMX-GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E" class="sect4">Client.java in the Simple Security Example</h4>
                  <div>
                     <p>The <code class="codeph">Client.java</code> class is shown in CODE&nbsp;EXAMPLE&nbsp;5-2.
                     </p>
                     <div class="section" id="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E__CODEEXAMPLE5-2RMICONNECTOREXAMPLESI-CB055F65">
                        <p class="subhead3" id="GUID-C95094F9-EF92-4896-9AC3-CB739FF6881E__GUID-13F3EEDD-02CA-4B14-820C-9E5CDA66CDB4"> CODE&nbsp;EXAMPLE&nbsp;5-2 RMI Connector Example (Simple Security) Class Client.java </p><pre class="pre codeblock"><code>public class Client { 
 
  public static void main(String[] args) { 
  try { 
      HashMap env = new HashMap(); 
 
      String[] credentials = new String[] { "username" , "password" }; 
      env.put("jmx.remote.credentials", credentials); 
      JMXServiceURL url = new JMXServiceURL( 
         "service:jmx:rmi:///jndi/rmi://localhost:9999/server");       
      JMXConnector jmxc = JMXConnectorFactory.connect(url, env); 
      MBeanServerConnection mbsc = jmxc.getMBeanServerConnection(); 
      String domains[] = mbsc.getDomains(); 
      for (int i = 0; i &lt; domains.length; i++) { 
         System.out.println("Domain[" + i + "] = " + domains[i]); 
      } 
       
      ObjectName mbeanName =  
          new ObjectName("MBeans:type=SimpleStandard"); 
      mbsc.createMBean("SimpleStandard", mbeanName, null, null); 
      // Perform MBean operations 
      [...] 
      
      mbsc.removeNotificationListener(mbeanName, listener); 
      mbsc.unregisterMBean(mbeanName); 
      jmxc.close(); 
    }  catch (Exception e) { 
      e.printStackTrace(); 
    } 
  } 
} 
</code></pre><p>The <code class="codeph">Client</code> class shown in CODE&nbsp;EXAMPLE&nbsp;5-2 populates an environment map <code class="codeph">env</code> with a set of credentials, namely the <code class="codeph">username</code> and <code class="codeph">password</code> expected by the <code class="codeph">Server</code>. These credentials are then given to an instance of <code class="codeph">JMXConnector</code> named <code class="codeph">jmxc</code> when the service URL of the connector stub and the environment map are passed to <code class="codeph">JMXConnectorFactory.connect()</code>. Through <code class="codeph">jmxc</code>, the <code class="codeph">Client</code> connects to the MBean server started by <code class="codeph">Server</code>, and performs MBean operations.
                        </p>
                        <p>When the connection is established, the credentials supplied in the environment map <code class="codeph">env</code> are sent to the server. The server then calls the <code class="codeph">authenticate()</code> method of the <code class="codeph">JMXAuthenticator</code> interface, passing the client credentials as parameters. The <code class="codeph">authenticate()</code> method authenticates the client and returns a subject that contains the set of principals upon which the access control checks will be performed.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-F86AE7C1-D6C1-4095-8E71-4EECFB46B760" name="GUID-F86AE7C1-D6C1-4095-8E71-4EECFB46B760"></a><h4 id="JSJMX-GUID-F86AE7C1-D6C1-4095-8E71-4EECFB46B760" class="sect4">Running the RMI Connector Example With Simple Security</h4>
                  <div>
                     <p>To run the RMI connector example with simple security, perform the following steps:</p>
                     <ol>
                        <li>
                           <p>Run the RMI connector example:</p><pre class="pre codeblock"><code>$ javac 
      mbeans/SimpleStandard.java \ 
      mbeans/SimpleStandardMBean.java \ 
      server/Server.java \ 
      client/Client.java \ 
      client/ClientListener.java 
</code></pre></li>
                        <li>Start an RMI registry on port <span class="bold">9999</span> of the local host. <pre class="pre codeblock"><code>$ export CLASSPATH=server ; rmiregistry 9999 &amp; 
</code></pre></li>
                        <li>Start the <code class="codeph">Server</code>. <pre class="pre codeblock"><code>$ java -classpath server:mbeans \ 
     -Djavax.net.ssl.keyStore=config/keystore \ 
     -Djavax.net.ssl.keyStorePassword=password \ 
     Server &amp; 
</code></pre><p>You will see confirmation of the creation of the MBean server and of the RMI connector.</p>
                        </li>
                        <li>Start the <code class="codeph">Client</code>. <pre class="pre codeblock"><code>$java -classpath client:server:mbeans \ 
     -Djavax.net.ssl.trustStore=config/truststore \ 
     -Djavax.net.ssl.trustStorePassword=trustword \ 
     Client 
</code></pre><p>You will see confirmation of the creation of the connector client, the various MBean operations followed by the closure of the connection.</p>
                        </li>
                     </ol>
                     <p>As you can see, all the above appears to proceed in exactly the same manner as the basic RMI connector example described in <a href="jmx-connectors.html#GUID-A4CA2A4D-49EE-4DA8-871F-DD633C28DAD9">JMX Connectors</a>. However, if you were to open <code class="codeph">password.properties</code> and change the password, you would see a <code class="codeph">java.lang.SecurityException</code> when you launched the <code class="codeph">Client</code>, and the connection would fail.
                     </p>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D" name="GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D"></a><h3 id="JSJMX-GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D" class="sect3">Subject Delegation</h3>
               <div>
                  <p>If your implementation requires the client end of the connection to perform different operations on behalf of multiple users or applications, and if you use the security mechanisms demonstrated in <a href="security.html#GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D">Simple Security</a> , then each different user would requires one secure connection for every operation it performs. If you expect your connector clients to interact with numerous users, then you can reduce the load on your system by implementing <span class="italic">subject delegation</span>. Subject delegation establishes a single secure connection for a user. This connection can be used to perform related operations on behalf of any number of users. The connection itself is made by an <span class="italic">authenticated</span> user. If the authenticated user granted a <code class="codeph">SubjectDelegationPermission</code> that allows it to act on behalf of other users, then operations can be performed over the connection on behalf of that user.
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-6D30665A-E576-4A9E-943C-2DA022F7A62D__GUID-84C1927E-41E6-429F-8AC1-5A6EE4EB5A2A">Analyzing the Secure RMI Connectors With Subject Delegation Example Classes</p>
                     <ol>
                        <li>
                           <p>Copy the source code from <a href="security-subject-delegation-example.html">Security with Subject Delegation</a> to the following <code class="codeph"><span class="variable" translate="no">work_dir</span>/jmx_examples/Security/subject_delegation</code> subdirectories and files:
                           </p>
                           <ul style="list-style-type: disc;">
                              <li><code class="codeph">/server/Server.java</code>:
                              </li>
                              <li><code class="codeph">/config/access.properties</code></li>
                              <li><code class="codeph">/config/java.policy</code></li>
                              <li><code class="codeph">/config/password.properties</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandardMBean.java</code></li>
                              <li><code class="codeph">/mbeans/SimpleStandard.java</code></li>
                              <li><code class="codeph">/client/Client.java</code></li>
                              <li><code class="codeph">/client/ClientListener.java</code></li>
                           </ul>
                        </li>
                        <li>
                           <p>Open all the <code class="codeph">*.java</code> and <code class="codeph">*.properties</code> files in your IDE or text editor.
                           </p>
                        </li>
                     </ol>
                     <p>The following sections contain the analysis of these files.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0" name="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0"></a><h4 id="JSJMX-GUID-AC42678F-30FF-4211-A547-2E46C13B38D0" class="sect4">Server.java in the Subject Delegation Example</h4>
                  <div>
                     <p>The <code class="codeph">Server.java</code> class is shown in CODE&nbsp;EXAMPLE&nbsp;5-3.
                     </p>
                     <div class="section" id="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0__CODEEXAMPLE5-2SECURERMICONNECTORSUB-CB0F3E34">
                        <p class="subhead3" id="GUID-AC42678F-30FF-4211-A547-2E46C13B38D0__GUID-3B5EA57D-1985-4CA3-809F-7E1F887F4852">CODE&nbsp;EXAMPLE&nbsp;5-3 Secure RMI Connector (Subject Delegation) Example Class Server.java </p><pre class="pre codeblock"><code>public class Server { 
 
   public static void main(String[] args) { 
     try { 
          MBeanServer mbs = MBeanServerFactory.createMBeanServer(); 
          HashMap env = new HashMap(); 
          env.put("jmx.remote.x.password.file", 
                  "config" + File.separator + "password.properties"); 
          env.put("jmx.remote.x.access.file", 
                  "config" + File.separator + "access.properties"); 
 
          JMXServiceURL url = new JMXServiceURL( 
             "service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
          JMXConnectorServer cs = 
              JMXConnectorServerFactory.newJMXConnectorServer(url, env, mbs); 
          cs.start(); 
     } catch (Exception e) { 
          e.printStackTrace(); 
     } 
   } 
} 
</code></pre><p>CODE&nbsp;EXAMPLE&nbsp;5-3 begins with the creation of an MBean server <code class="codeph">mbs</code>, and the population of an environment map <code class="codeph">env</code> with a password file and an access file, called <code class="codeph">password.properties</code> and <code class="codeph">access.properties</code> respectively:
                        </p>
                        <ul style="list-style-type: disc;">
                           <li>The password file contains a username and password combination that is used to authenticate users that try to make connections.</li>
                           <li>The access file contains a user name and access level combination that is used to authorize access to the MBeans in the MBean server. The access level is either readwrite or readonly.</li>
                        </ul>
                        <p>The <code class="codeph">Server</code> then creates a connector server named <code class="codeph">cs</code>, and starts it in exactly the same way as in the previous RMI connector examples.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-70D3FD66-4A10-4640-9A78-722C046CD9EB" name="GUID-70D3FD66-4A10-4640-9A78-722C046CD9EB"></a><h4 id="JSJMX-GUID-70D3FD66-4A10-4640-9A78-722C046CD9EB" class="sect4">java.policy in the Subject Delegation Example</h4>
                  <div>
                     <p>The <code class="codeph">java.policy</code> file grants to <code class="codeph">username</code> a <code class="codeph">SubjectDelegationPermission</code> so it can perform operations on behalf of the user <code class="codeph">delegate</code>, an instance of <code class="codeph">JMXPrincipal</code> created by the <code class="codeph">Client</code> class. The <code class="codeph">java.policy</code> file is required when launching the <code class="codeph">Server</code> class.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122" name="GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122"></a><h4 id="JSJMX-GUID-BBEDE9C9-5C81-4845-A307-2B402DE2E122" class="sect4">SimpleStandardMBean.java in the Subject Delegation Example</h4>
                  <div>
                     <p>The <code class="codeph">SimpleStandardMBean</code> class defines the same straightforward MBean interface used in previous examples.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-20646635-48E2-4EE5-9061-9D68057E31CE" name="GUID-20646635-48E2-4EE5-9061-9D68057E31CE"></a><h4 id="JSJMX-GUID-20646635-48E2-4EE5-9061-9D68057E31CE" class="sect4">SimpleStandard.java in the Subject Delegation Example</h4>
                  <div>
                     <p>The <code class="codeph">SimpleStandard</code> class defines the same, straightforward MBean used in previous examples.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-7F9DDC38-0EFE-4A45-B38F-72ABAF50A486" name="GUID-7F9DDC38-0EFE-4A45-B38F-72ABAF50A486"></a><h4 id="JSJMX-GUID-7F9DDC38-0EFE-4A45-B38F-72ABAF50A486" class="sect4">ClientListener.java in the Subject Delegation Example</h4>
                  <div>
                     <p>The <code class="codeph">ClientListener</code> class defines the same, straightforward notification listener used in previous examples.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF" name="GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF"></a><h4 id="JSJMX-GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF" class="sect4">Client.java in the Subject Delegation Example</h4>
                  <div>
                     <p>The <code class="codeph">Client.java</code> class is shown in CODE&nbsp;EXAMPLE&nbsp;5-4.
                     </p>
                     <div class="section">
                        <p class="subhead3" id="GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF__GUID-03FCE024-DD53-4310-96C5-72486E45A7A5">CODE&nbsp;EXAMPLE&nbsp;5-4 Secure RMI Connector (Subject Delegation) Example Class Client.java </p><pre class="pre codeblock"><code>public class Client { 
 
  public static void main(String[] args) { 
    try { 
         HashMap env = new HashMap(); 
         String[] credentials = new String[] { "username" , "password" }; 
         env.put("jmx.remote.credentials", credentials); 
         JMXServiceURL url = new JMXServiceURL( 
            "service:jmx:rmi:///jndi/rmi://localhost:9999/server"); 
         JMXConnector jmxc = JMXConnectorFactory.connect(url, env); 
         Subject delegationSubject = 
            new Subject(true, 
                Collections.singleton(new JMXPrincipal("delegate")), 
                Collections.EMPTY_SET, 
                Collections.EMPTY_SET); 
 
         MBeanServerConnection mbsc = 
            jmxc.getMBeanServerConnection(delegationSubject); 
         String domains[] = mbsc.getDomains(); 
         ObjectName mbeanName = 
            new ObjectName("MBeans:type=SimpleStandard"); 
         mbsc.createMBean("SimpleStandard", mbeanName, null, null); 
         // Perform MBean operations 
         // 
 
[...] 
         mbsc.removeNotificationListener(mbeanName, listener); 
         mbsc.unregisterMBean(mbeanName); 
         jmxc.close(); 
     } catch (Exception e) { 
         e.printStackTrace(); 
     } 
  } 
} 
 
</code></pre><p>CODE&nbsp;EXAMPLE&nbsp;5-4 begins with the creation of an environment map <code class="codeph">env</code> that is populated with a user name <code class="codeph">username</code> and a password <code class="codeph">password</code>. These strings match the user name and password stored in the <code class="codeph">password.properties</code> file that is held by the <code class="codeph">Server</code> to authenticate users accessing the connector server.
                        </p>
                        <p>A JMX technology connector client <code class="codeph">jmxc</code> is created in the same way as in the previous RMI connector examples, with the user name and password passed into the environment map <code class="codeph">env</code>.
                        </p>
                        <p>The <code class="codeph">Client</code> then creates an instance of <code class="codeph">Subject</code>, called <code class="codeph">delegationSubject</code>, with a <code class="codeph">Principal</code> that is an instance of <code class="codeph">JMXPrincipal</code>, named <code class="codeph">delegate</code>.
                        </p>
                        <p>An MBean server connection, named <code class="codeph">mbsc</code>, is created by calling the <code class="codeph">getMBeanServerConnection()</code> method of <code class="codeph">JMXConnector</code>, with <code class="codeph">delegationSubject</code> passed in as a parameter. This MBean server connection therefore allows operations to be performed on the remote MBean server on behalf of the principals stored in the <code class="codeph">delegationSubject</code>, which in this example is the <code class="codeph">JMXPrincipal</code> named <code class="codeph">delegate</code>.
                        </p>
                        <p>The example continues by creating and registering the <code class="codeph">SimpleStandard</code> MBean in the MBean server, and performing operations on it, in exactly the same way as in the previous examples.
                        </p>
                     </div>
                     <!-- class="section" -->
                  </div>
               </div>
               <div class="sect3"><a id="GUID-43E31352-4E57-401E-A785-79698BFC50CF" name="GUID-43E31352-4E57-401E-A785-79698BFC50CF"></a><h4 id="JSJMX-GUID-43E31352-4E57-401E-A785-79698BFC50CF" class="sect4">Running the Secure RMI Connector Example With Subject
Delegation</h4>
                  <div>
                     <p>To run the secure RMI connector example with subject delegation,
perform the following steps:</p>
                     <ol>
                        <li>Run the secure RMI connector example:
<pre class="pre codeblock"><code>
$ javac  mbeans/SimpleStandard.java \ 
  mbeans/SimpleStandardMBean.java \ 
  server/Server.java \ 
  client/Client.java \ 
  client/ClientListener.java 
 
</code></pre></li>
                        <li>Start an RMI registry on port <span class="bold">9999</span> of the local host.
<pre class="pre codeblock"><code>$ export CLASSPATH=server ; rmiregistry 9999 &amp;</code></pre></li>
                        <li>Start the <code class="codeph">Server</code>.
<pre class="pre codeblock"><code>
$ java -classpath server:mbeans \ 
  -Djava.security.policy=config/java.policy Server &amp; 
 
</code></pre><p>You will see confirmation of the creation of the MBean server,
the initialization of the environment map, the creation of the RMI
connector, and the registration of the connector in the MBean
server.</p>
                        </li>
                        <li>Start the <code class="codeph">Client</code>. <pre class="pre codeblock"><code>$java -classpath client:server:mbeans Client</code></pre><p>You will see confirmation of the creation of the connector
client, the creation of the delegation subject, the connection to
the MBean server and the various MBean operations followed by the
closure of the connection.</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
            <div class="sect2"><a id="GUID-2A161539-E347-4CF1-84B9-482BC0C621C7" name="GUID-2A161539-E347-4CF1-84B9-482BC0C621C7"></a><h3 id="JSJMX-GUID-2A161539-E347-4CF1-84B9-482BC0C621C7" class="sect3">Fine-Grained Security</h3>
               <div>
                  <p>You can implement a more fine-grained level of security in your connectors by managing user access through the Java Authentication and Authorization Service (JAAS) and Java platform Standard Edition (Java SE) Security Architecture. JAAS and Java SE security is based on the use of security managers and policy files to allocate different levels of access to different users. You can specify which users are allowed to perform which operations.</p>
                  <p>The two examples in this section are very similar to those shown in <a href="security.html#GUID-EFC2A37D-307F-4001-9D2F-6F0A2A3BC51D">Simple Security</a>, with the difference that policy-based access control replaces the simple, file-based access control.
                  </p>
                  <div class="section">
                     <p class="subhead2" id="GUID-2A161539-E347-4CF1-84B9-482BC0C621C7__GUID-082223A0-DBDF-429B-992E-546936F4EC04">Analyzing the Secure RMI Connectors With Fine-Grained Security Example Classes</p>
                     <ol>
                        <li>
                           <div class="p">Copy the source code from <a href="fine-grained-security-example.html">Fine-Grained Security</a> to the <code class="codeph"><span class="variable" translate="no">work_dir</span>/jmx_examples/Security/fine_grained</code> subdirectories and files:
                              <ul style="list-style-type: disc;">
                                 <li><code class="codeph">/server/Server.java</code></li>
                                 <li><code class="codeph">/config/java.policy</code></li>
                                 <li><code class="codeph">/config/keystore</code></li>
                                 <li><code class="codeph">/config/password.properties</code></li>
                                 <li><code class="codeph">/config/truststore</code></li>
                                 <li><code class="codeph">/mbeans/SimpleStandard.java</code></li>
                                 <li><code class="codeph">/mbeans/SimpleStandardMBean.java</code></li>
                                 <li><code class="codeph">/client/ClientListener.java</code></li>
                                 <li><code class="codeph">/client/Client.java</code></li>
                              </ul>
                           </div>
                        </li>
                        <li>Open all of the <code class="codeph">*.java</code> and <code class="codeph">*.properties</code> files in your IDE or text editor. 
                        </li>
                     </ol>
                     <p>The following sections contain the analysis of these files.</p>
                  </div>
                  <!-- class="section" -->
               </div>
               <div class="sect3"><a id="GUID-2B52C953-4851-4F8A-A63B-24279CB76ED0" name="GUID-2B52C953-4851-4F8A-A63B-24279CB76ED0"></a><h4 id="JSJMX-GUID-2B52C953-4851-4F8A-A63B-24279CB76ED0" class="sect4">Server.java in the Fine-Grained Security Example</h4>
                  <div>
                     <p>The <code class="codeph">Server.java</code> class in this example is very similar to the one used in <a href="security.html#GUID-AC42678F-30FF-4211-A547-2E46C13B38D0">Server.java in the Subject Delegation Example</a>. The only difference is that there is no <code class="codeph">access.properties</code> file to map into the environment map in the fine-grained example. Otherwise, the two classes are identical.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-D70D2360-DCA8-41C7-84A7-D2E3896495DF" name="GUID-D70D2360-DCA8-41C7-84A7-D2E3896495DF"></a><h4 id="JSJMX-GUID-D70D2360-DCA8-41C7-84A7-D2E3896495DF" class="sect4">java.policy in the Fine-Grained Security Example</h4>
                  <div>
                     <p>The <code class="codeph">java.policy</code> file grants the following permissions:
                     </p>
                     <ul style="list-style-type: disc;">
                        <li>All permissions to the <code class="codeph">server</code> code base, so that the connector server can create the connectors, and then perform the operations requested by remote user calls
                        </li>
                        <li><code class="codeph">MBeanTrustPermission</code> to the <code class="codeph">mbeans</code> code base, allowing trusted MBeans to register in the MBean server
                        </li>
                        <li>Permission to perform the various MBean and MBean server operations for the user represented by a <code class="codeph">JMXPrincipal</code> named <code class="codeph">username.</code></li>
                     </ul>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8A599F3A-D505-4CA6-8FD5-ADA43EDB97A1" name="GUID-8A599F3A-D505-4CA6-8FD5-ADA43EDB97A1"></a><h4 id="JSJMX-GUID-8A599F3A-D505-4CA6-8FD5-ADA43EDB97A1" class="sect4">SimpleStandardMBean.java in the Fine-Grained Security Example</h4>
                  <div>
                     <p>The <code class="codeph">SimpleStandardMBean</code> class defines the same straightforward MBean interface used in previous examples.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192" name="GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192"></a><h4 id="JSJMX-GUID-EB298AF7-E702-4DFB-BCB3-3F60AA706192" class="sect4">SimpleStandard.java in the Fine-Grained Security Example</h4>
                  <div>
                     <p>The <code class="codeph">SimpleStandard</code> class defines the same straightforward MBean used in previous examples.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-8DDA6F9D-D791-46D6-B9CC-EAC4ECA4AA69" name="GUID-8DDA6F9D-D791-46D6-B9CC-EAC4ECA4AA69"></a><h4 id="JSJMX-GUID-8DDA6F9D-D791-46D6-B9CC-EAC4ECA4AA69" class="sect4">ClientListener.java in the Fine-Grained Security Example</h4>
                  <div>
                     <p>The <code class="codeph">ClientListener</code> class defines the same straightforward notification listener used in previous examples.
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-B70B9869-AA3F-42E7-BF20-5F60419508B2" name="GUID-B70B9869-AA3F-42E7-BF20-5F60419508B2"></a><h4 id="JSJMX-GUID-B70B9869-AA3F-42E7-BF20-5F60419508B2" class="sect4">Client.java in the Fine-Grained Security Example</h4>
                  <div>
                     <p>The <code class="codeph">Client.java</code> class is exactly the same as the one used in <a href="security.html#GUID-393CA4EB-3C30-4812-94B4-8D421B3115AF">Client.java in the Subject Delegation Example</a> .
                     </p>
                  </div>
               </div>
               <div class="sect3"><a id="GUID-EDF837EA-A993-4000-9700-1700DD516455" name="GUID-EDF837EA-A993-4000-9700-1700DD516455"></a><h4 id="JSJMX-GUID-EDF837EA-A993-4000-9700-1700DD516455" class="sect4">Running the RMI Connector Example With Fine-Grained Security</h4>
                  <div>
                     <p>To run the RMI connector example with fine-grained security, perform the following steps:</p>
                     <ol>
                        <li>Run the RMI connector example: <pre class="pre codeblock"><code>
$ javac 
      mbeans/SimpleStandard.java \ 
      mbeans/SimpleStandardMBean.java \ 
      server/Server.java \ 
      client/Client.java \ 
      client/ClientListener.java 
 
</code></pre></li>
                        <li>Start an RMI registry on port <span class="bold">9999</span> of the local host. <pre class="pre codeblock"><code>$ export CLASSPATH=server ; rmiregistry 9999 &amp;</code></pre></li>
                        <li>Start the <code class="codeph">Server</code>. <pre class="pre codeblock"><code>
<code class="codeph">$ </code>java -classpath server:mbeans \ 
     -Djavax.net.ssl.keyStore=config/keystore \ 
     -Djavax.net.ssl.keyStorePassword=password \ 
     -Djava.security.manager \ 
     -Djava.security.policy=config/java.policy \ 
     Server &amp; 
 
</code></pre><p>You will see confirmation of the initialization of the environment map, the creation of the MBean server and of the RMI connector.</p>
                        </li>
                        <li>Start the <code class="codeph">Client</code>. <pre class="pre codeblock"><code>
 
$ java -classpath client:server:mbeans \ 
     -Djavax.net.ssl.trustStore=config/truststore \ 
     -Djavax.net.ssl.trustStorePassword=trustword \ 
     Client 
 
</code></pre><p>You will see confirmation of the creation of the connector client, the connection to the RMI server and the various MBean operations followed by the closure of the connection.</p>
                        </li>
                     </ol>
                  </div>
               </div>
            </div>
         </div>
      </article>
   </body>
</html>
